<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Facebook Lite</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
    }

    #main {
      width: 100%;
      height: 100%;
      background-color: #f0f2f5;
      display: flex;
      flex-direction: column;
    }

    #upper {
      height: 80px;
      background-color: #3b5998;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
    }

    #upper-two {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }

    #upper-down {
      padding: 0 16px;
      height: 60px;
      background-color: #3b5998;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #upper-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #upper-a {
      height: 90px;
      background-color: #ffffff;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #uper-a1 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-grow: 1;
    }

    #image {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      overflow: hidden;
      object-fit: cover;
      background-color: #ddd;
    }
    #uper-a1 #image img{
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #story-div {
      width: 100vw;
      height: 40vh;
      /* background-color: red; */
      /* overflow-x: auto;
      white-space:  nowrap;
      position: relative; */
      padding: 0 16px;
      display: flex;
      align-items: center;  
      gap: 25px;
      background-color: red;
      /* justify-content: space-between; */
       /* flex-wrap: wrap; */

     
    }

    #story1 {
      width: 10vw;
      height: 20vh;
      background-color: rgb(227, 10, 251);
      overflow-x: auto;
      white-space:  nowrap;
      width: calc(25% - 24px);
      height: 100px;
      background-color: #ddd;
      margin-bottom: 16px;
      cursor: pointer; 
      overflow: hidden;
      display: flex;
    
    }
    #story2 {
      width: 10vw;
      height: 20vh; 

      overflow-x: auto;
      /* white-space:  nowrap; */
      width: calc(25% - 24px);
      height: 100px;
      background-color: #ddd;
      margin-bottom: 16px;
      cursor: pointer; 
      overflow: hidden;
      display: flex;
      overflow-x: scroll;
      overflow-y: hidden;
      
    }
     img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    #public {
      height: 60px;
      background-color: #ffffff;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    #public #image img{
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #public-a {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #post-sec {
      background-color: #ffffff;
      display: flex;
      flex-direction: column;
    }

    #post {
      width: 100%;
      background-color: #ffffff;
      margin-bottom: 16px;
    }

    #post-image {
      width: 100%;
      height: 100%;
      overflow: hidden;
      object-fit: cover;
      height: 200px;
    }
    #post-image img{
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #like-sec {
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 16px;
    }
    #like-sec i{
      font-size: 7vw;
    }
    .caption-container {
      padding: 8px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    .caption-container p {
      font-size: 16px;
      color: #333;
    }
    a{
      text-decoration: none;
    }

    .ri-thumb-up-fill[style="color: blue;"] {
      color: blue;
    }
    .hidden {
  display: none;
}
.story-container{
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#story-div img{
  width: 100%;
  height: 100%;
  object-fit: cover;
}
button.like-button {
  border: none;
  padding: 0;
  background: none;
}

    @media (max-width: 768px) {
      #upper {
        padding: 8px;
      }

      #upper-down {
        padding: 8px;
        
      }
      #upper-main{
        padding: 1vw;
        gap: 74px;
      }

      #upper-a {
        padding: 8px;
      }

      #story-div {
        padding: 8px;
      }

      #public {
        padding: 8px;
      }

      #post-sec {
        padding: 8px;
      }

      #like-sec {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div id="main">
    <div id="upper">
      <div id="upper-one">
        <h1 style="color: #ffffff;">Facebook</h1>
      </div>
      <div id="upper-two">
        <a href="/search"><h1><i class="ri-search-line" style="color: #ffffff;"></i></h1></a>
       <a href="/menu"><h1><i class="ri-menu-line" style="color: #ffffff;"></i></h1></a>
      </div>
    </div>

 
    <div id="upper-down">
      <div id="upper-main">
      <a href="/main"><h1><i class="ri-home-2-line" style="color: #ffffff;"></i></h1></a>
      <a href="/addFrds/<%=user._id%>"><h1><i class="ri-user-line" style="color: #ffffff;"></i></h1></a>
       <a href="/message"><h1><i class="ri-chat-3-line" style="color: #ffffff;"></i></h1></a>
        <h1><i class="ri-notification-line" style="color: #ffffff;"></i></h1>
      </div>
    </div>

   
    <div id="upper-a">
      <div id="uper-a1">
      <a href="/profile">
    <div id="image"><img src="/images/uploads/<%=user.profileImage%>" alt=""></div>
      </a>
          <a href="/createp"><input type="text" placeholder="Write Something here.." style="border: none; outline: none; background: transparent; width: calc(100% - 72px); color: #000;"></a>
        <a href="/createp"><h1 style="color: #9c9c9c; cursor: pointer;" onclick="document.getElementById('fileInput').click();">Photo</h1></a>
        <div id="pic">
        
        </div>
      </div>
    </div>
    
    <div id="story-div">
      <div id="story1"></div>
      <% user.friends.forEach(friend => { %>
        <!-- <h2><%= friend.username %>'s Story</h2> -->
        <% friend.stories.forEach(story => { %>
          <div id="story2"><img src="/images/uploads/<%= story.file %>" alt="">
          </div>
        <% }) %>
    <% }) %>
    </div>

    
    <form id="storyForm" action="/story" method="post" enctype="multipart/form-data" class="hidden">
      <label for="storyFileInput" id="fileInputLabel" class="hidden">Choose File</label>
      <input type="file" name="storyFile" id="storyFileInput" accept="image/*, video/*" class="hidden">
      <button type="submit" id="submitStory">Upload Story</button>
    </form>
    
   
    <% posts.reverse().forEach(post => { %>
      <div id="public">
        <a href="/friendlist/<%= post.user ? post.user._id : '' %>">
          <div id="public-a">
            <div id="image">
              <% if (post.user && post.user.profileImage) { %>
                <img src="/images/uploads/<%= post.user.profileImage %>" alt="">
              <% } else { %>
                <img src="/images/uploads/<%= user.profileImage %>" alt="Profile Image">
              <% } %>
            </div>
            <% if (post.user && post.user.username) { %>
              <h1 style="color: #385898;"><%= post.user.username %></h1>
            <% } else { %>
              <h1 style="color: #385898;"><%= user.username %></h1>
            <% } %>
          </div>
        </a>
        <div id="icon">
          <a href="/save/<%= post._id %>"><h1><i class="ri-more-2-fill" style="color: #385898;"></i></h1></a>
        </div>
      </div>
      
      <div id="caption">
        <div class="caption-container">
          <p><%= post.caption %></p>
        </div>
      </div>
      <div id="post">
        <a href="/openprofile/<%= post._id %>">
          <div id="post-image">
            <img src="/images/uploads/<%= post.picture %>" alt="">
          </div>
          <div id="like-sec">
            <button class="like-button" data-post-id="<%= post._id %>">
              <% if (String(post.likes).includes(String(user._id))) { %>
                <i class="ri-thumb-up-fill" style="color: blue;"></i>
              <% } else { %>
                <i class="ri-thumb-up-line" style="color: #385898;"></i>
              <% } %>
            </button>
            <a href="/comment/<%= post._id %>"><h2><i class="ri-chat-3-line"></i></h2></a>
          </div>
          
      </div>
    <% }) %>
    
      
      
    </div>



<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    
    document.addEventListener("DOMContentLoaded", function() {
  const firstStoryContainer = document.getElementById("story1");
  const fileInput = document.getElementById("storyFileInput");

 
  firstStoryContainer.addEventListener("click", function() {
    fileInput.click(); 
  });

  
  fileInput.addEventListener("change", function() {
    document.getElementById("storyForm").submit(); 
  });
});



document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll(".like-button").forEach(function(button) {
    button.addEventListener("click", function(event) {
      event.preventDefault(); 
      
      const postId = this.getAttribute("data-post-id");
      const likeButton = this;

      axios.post(`/like/${postId}`)
        .then(response => {
          const data = response.data;
          if (data.success) {
            if (data.likes.includes("<%= user._id %>")) {
              likeButton.innerHTML = '<i class="ri-thumb-up-fill" style="color: blue;"></i>';
            } else {
              likeButton.innerHTML = '<i class="ri-thumb-up-line" style="color: #385898;"></i>';
            }
          } else {
            console.error(data.error);
          }
        })
        .catch(error => {
          console.error("Error:", error);
        });
    });
  });
});


  </script>
</body>
</html>
